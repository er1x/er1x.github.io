<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Con este post voy a dar comienzo a una serie en la que voy a realizar un tutorial completo del framework Aurelia, que ya presenté en un post anterior.En esta serie de posts vamos a construir una senci"><meta name="keywords" content="frontend,aurelia"><meta property="og:type" content="article"><meta property="og:title" content="Aurelia series 1: MVVM e Inyección de dependencias"><meta property="og:url" content="https://github.com/er1x/2015/07/aurelia-1-mvvm-e-inyeccion-dependencias/index.html"><meta property="og:site_name" content="Emilio J. Grande | Web Developer"><meta property="og:description" content="Con este post voy a dar comienzo a una serie en la que voy a realizar un tutorial completo del framework Aurelia, que ya presenté en un post anterior.En esta serie de posts vamos a construir una senci"><meta property="og:locale" content="default"><meta property="og:image" content="https://github.com/images/2015-07/aurelia-tutorial.png"><meta property="og:image" content="https://github.com/images/2015-07/mvvm.png"><meta property="og:image" content="https://github.com/images/2015-07/base-1.png"><meta property="og:image" content="https://github.com/images/2015-07/jspm-init.png"><meta property="og:image" content="https://github.com/images/2015-07/index-with-modules.png"><meta property="og:image" content="https://github.com/images/2015-07/aurelia-install.png"><meta property="og:image" content="https://github.com/images/2015-07/index-modified.png"><meta property="og:image" content="https://github.com/images/2015-07/app-html.png"><meta property="og:image" content="https://github.com/images/2015-07/app-js.png"><meta property="og:image" content="https://github.com/images/2015-07/helloworld-1.png"><meta property="og:image" content="https://github.com/images/2015-07/aurelia-http.png"><meta property="og:image" content="https://github.com/images/2015-07/model-1.png"><meta property="og:image" content="https://github.com/images/2015-07/app-js2.png"><meta property="og:image" content="https://github.com/images/2015-07/viewmodified.png"><meta property="og:image" content="https://github.com/images/2015-07/result.png"><meta property="og:updated_time" content="2017-03-11T12:54:27.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Aurelia series 1: MVVM e Inyección de dependencias"><meta name="twitter:description" content="Con este post voy a dar comienzo a una serie en la que voy a realizar un tutorial completo del framework Aurelia, que ya presenté en un post anterior.En esta serie de posts vamos a construir una senci"><meta name="twitter:image" content="https://github.com/images/2015-07/aurelia-tutorial.png"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>Aurelia series 1: MVVM e Inyección de dependencias</title></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" style="display:none"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></span><br><div id="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Que-es-Model-View-ViewModel"><span class="toc-number">1.</span> <span class="toc-text">Qué es Model-View-ViewModel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creando-el-proyecto"><span class="toc-number">2.</span> <span class="toc-text">Creando el proyecto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Agregando-JSPM-al-proyecto"><span class="toc-number">2.1.</span> <span class="toc-text">Agregando JSPM al proyecto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Instalando-Aurelia"><span class="toc-number">2.2.</span> <span class="toc-text">Instalando Aurelia</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Primeros-ViewModel-y-View"><span class="toc-number">3.</span> <span class="toc-text">Primeros ViewModel y View</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cargando-el-framework"><span class="toc-number">3.1.</span> <span class="toc-text">Cargando el framework</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Primeros-view-y-viewmodel"><span class="toc-number">3.2.</span> <span class="toc-text">Primeros view y viewmodel</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#¿Y-el-model"><span class="toc-number">4.</span> <span class="toc-text">¿Y el model?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vale-pero-¿a-que-viene-lo-del-inject"><span class="toc-number">4.1.</span> <span class="toc-text">Vale, pero, ¿a qué viene lo del inject?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Modificando-App"><span class="toc-number">5.</span> <span class="toc-text">Modificando App</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#app-js"><span class="toc-number">5.1.</span> <span class="toc-text">app.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#app-html"><span class="toc-number">5.2.</span> <span class="toc-text">app.html</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#En-resumen"><span class="toc-number">6.</span> <span class="toc-text">En resumen</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">7.</span> <span class="toc-text"></span></a></li></ol></div></span></div><div class="content index width mx-auto px2 my4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Aurelia series 1: MVVM e Inyección de dependencias</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Emilio J. Grande | Web Developer</span></span><div class="postdate">&nbsp;<time datetime="2015-07-22T17:31:00.000Z" itemprop="datePublished">22-07-2015</time></div><div class="article-tag"><i class="fa fa-tag"></i> <a class="tag-link" href="/tags/aurelia/">aurelia</a>, <a class="tag-link" href="/tags/frontend/">frontend</a></div></div></header><div class="content" itemprop="articleBody"><p><img src="/images/2015-07/aurelia-tutorial.png" alt="Aurelia Framework"></p><p>Con este post voy a <strong>dar comienzo a una serie en la que voy a realizar un tutorial completo del framework <a href="http://aurelia.io/" target="_blank" rel="external">Aurelia</a></strong>, que ya <a href="/2015/07/introduccion-aurelia-framework/">presenté en un post anterior</a>.</p><p>En esta serie de posts <strong>vamos a construir una sencilla aplicación CRUD, desde cero, que conecte con una API externa</strong>.</p><h2 id="Que-es-Model-View-ViewModel"><a href="#Que-es-Model-View-ViewModel" class="headerlink" title="Qué es Model-View-ViewModel"></a>Qué es <em>Model-View-ViewModel</em></h2><p>Aurelia es un framework que implementa MVVM (Model-View-ViewModel).</p><p><strong>TL;DR;</strong> MVVM es una forma de separar las responsabilidades de aplicación en partes, y que no tengas que andar toqueteando todo cada vez que quieres modificar algo.</p><hr><p>MVVM es un patrón que segmenta nuestra aplicación en tres tipos de componentes diferenciados, a saber:</p><ul><li><p><strong>Models</strong>: son clases que albergarán (accediendo o no a BBDD) información sobre los elementos del negocio. Por ejemplo, si tengo una aplicación de series de televisión, podría tener una clase <em>Series</em>, con métodos para obtener una lista, preguntar por una en particular… etc.</p></li><li><p><strong>Views</strong>: son la parte de la aplicación que presenta los datos al usuario. Aquí hay poco que decir, ya que son plantillas HTML. En este tipo de frameworks incluyen un pequeño lenguaje de plantillas para poder meter datos fácilmente.</p></li><li><p><strong>ViewModels</strong>: son clases que están en el medio de los modelos y las vistas. Contienen propiedades que son enlazadas en la vista (mediante el lenguaje de plantillas) e implementan los métodos que tienen lugar cuando un usuario pulsa en algún sitio, por ejemplo. Habitualmente dependen de los modelos de donde obtienen los datos.</p></li></ul><p><img src="/images/2015-07/mvvm.png" alt="mvvm"></p><p>Imagen de MVVM de <a href="https://en.wikipedia.org/wiki/Model_View_ViewModel" target="_blank" rel="external">Wikipedia</a>.</p><p>Suficiente teoría. ¡Vamos a hacer algo!</p><h2 id="Creando-el-proyecto"><a href="#Creando-el-proyecto" class="headerlink" title="Creando el proyecto"></a>Creando el proyecto</h2><p>En lugar de utilizar el generador de Yeoman para Aurelia vamos a crear el proyecto desde cero, para aprender mejor cómo funciona.</p><p>Para ello, creamos una carpeta con un fichero index.html simple.</p><p><img src="/images/2015-07/base-1.png" alt="base"></p><h3 id="Agregando-JSPM-al-proyecto"><a href="#Agregando-JSPM-al-proyecto" class="headerlink" title="Agregando JSPM al proyecto"></a>Agregando JSPM al proyecto</h3><p>Para instalar nuestras dependencias de frontend vamos a utilizar el gestor JSPM, el cual <a href="/2015/07/frontend-modular-es6-jspm/">ya te enseñé como instalar y usar</a>. Veamos rápidamente cómo:</p><p><img src="/images/2015-07/jspm-init.png" alt="jspm-init"></p><p>Con JSPM añadido, modificamos nuestro index.html para incluir el cargador de módulos y el fichero de dependencias.</p><p><img src="/images/2015-07/index-with-modules.png" alt="index.html con jspm"></p><h3 id="Instalando-Aurelia"><a href="#Instalando-Aurelia" class="headerlink" title="Instalando Aurelia"></a>Instalando Aurelia</h3><p>Simplemente indicamos a jspm lo que debe instalar, que en este caso son dos dependencias: <strong><a href="https://github.com/aurelia/framework">aurelia-framework</a></strong> y <strong><a href="https://github.com/aurelia/bootstrapper">aurelia-bootstrapper</a></strong>.</p><p><img src="/images/2015-07/aurelia-install.png" alt="instalando aurelia"></p><h2 id="Primeros-ViewModel-y-View"><a href="#Primeros-ViewModel-y-View" class="headerlink" title="Primeros ViewModel y View"></a>Primeros <em>ViewModel</em> y <em>View</em></h2><p>Ya tenemos el proyecto base listo. A continuación tendremos que:</p><ul><li>Cargar el framework en la página.</li><li>Crear los primeros view y viewmodel que debe cargar.</li></ul><p>Vamos con ello:</p><h3 id="Cargando-el-framework"><a href="#Cargando-el-framework" class="headerlink" title="Cargando el framework"></a>Cargando el framework</h3><p>Sólo es necesario importar aurelia-bootstrapper con <a href="https://github.com/systemjs/systemjs">SystemJS</a>, e indicarle un punto de montaje, en este caso el body.</p><p><img src="/images/2015-07/index-modified.png" alt="index.html modificado"></p><h3 id="Primeros-view-y-viewmodel"><a href="#Primeros-view-y-viewmodel" class="headerlink" title="Primeros view y viewmodel"></a>Primeros <em>view</em> y <em>viewmodel</em></h3><p>Por defecto, Aurelia se va a por los ficheros app.js y app.html en busca de los primeros view y viewmodel. Esto puede cambiarse, pero de momento lo vamos a dejar así y a crear ambos ficheros.</p><p><img src="/images/2015-07/app-html.png" alt="app.html"><br><img src="/images/2015-07/app-js.png" alt="app.js"></p><p>Si te leíste el post de introducción de Aurelia no verás nada nuevo. Básicamente tenemos <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/template" target="_blank" rel="external">plantillas HTML5</a> (view) y <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes" target="_blank" rel="external">clases ECMAScript 2015</a> (viewmodel).</p><p>Los atributos de la clase tienen su reflejo en la vista. Esto se conoce como data-binding y profundizaremos más en ello en otro post.</p><p><img src="/images/2015-07/helloworld-1.png" alt="hello world"></p><h2 id="¿Y-el-model"><a href="#¿Y-el-model" class="headerlink" title="¿Y el model?"></a>¿Y el <em>model</em>?</h2><p>¡Necesitamos algún sitio de donde sacar datos! En este caso queremos obtener un listado de películas de Star Wars.</p><p>Para hacer esto, vamos a crear un modelo: films.js. Pero antes, tenemos que tener una manera de conseguir los datos de las pelis, que los vamos a sacar de <a href="https://swapi.co/" target="_blank" rel="external">https://swapi.co/</a>.</p><p>Necesitamos algo para hacer peticiones AJAX, y en este caso vamos a usar el <strong><a href="https://github.com/aurelia/http-client">cliente HTTP de aurelia</a></strong>, aunque podríamos usar cualquier otro.</p><p>Para instalarlo, con jspm:</p><p><img src="/images/2015-07/aurelia-http.png" alt="instalando cliente http de aurelia"></p><p>Ahora, tenemos que escribir nuestro modelo de forma que haga uso del cliente HTTP.</p><p><img src="/images/2015-07/model-1.png" alt="modelo"></p><p>Vamos a explicar un poco qué hace esta clase:</p><ul><li><p><strong>Importamos como dependencias el cliente HTTP</strong> que hemos instalado antes, <strong>y la función inject</strong> que nos permitirá inyectar esta dependencia en la clase Films.</p></li><li><p>Utilizamos el <strong>decorator @inject</strong> para agregar la dependencia y la ponemos en una propiedad en el constructor. Los decorators son propios de ES7 y su sintaxis no es definitiva.</p></li><li><p>Por último, agregamos una función all, que hace una <strong>llamada a la API REST</strong> de Star Wars y <strong>devuelve una promesa</strong> con el contenido de la respuesta.</p></li></ul><h3 id="Vale-pero-¿a-que-viene-lo-del-inject"><a href="#Vale-pero-¿a-que-viene-lo-del-inject" class="headerlink" title="Vale, pero, ¿a qué viene lo del inject?"></a>Vale, pero, ¿a qué viene lo del <em>inject</em>?</h3><p>Puede que te estés preguntando para qué es esto del inject, ya que al fin y al cabo, podríamos instanciar el cliente HTTP de aurelia dentro del constructor de Films.</p><p>Lo cierto es que es así, pero el problema viene si queremos hacer testing de esa clase. <strong>Si de alguna manera le pasamos sus dependencias podemos testearla más fácilmente</strong>, ya que podemos hacer que estas dependencias sean mocks, stubs etc. de forma que probemos únicamente la clase objetivo, sin intervenir nada más.</p><p>Esta manera de trabajar <strong>es un patrón conocido como <a href="https://es.wikipedia.org/wiki/Inyecci%C3%B3n_de_dependencias" target="_blank" rel="external">inyección de dependencias</a></strong>.</p><h2 id="Modificando-App"><a href="#Modificando-App" class="headerlink" title="Modificando App"></a>Modificando App</h2><p>Con esta nueva clase que nos hemos creado ya podemos obtener datos para presentar en la vista principal.</p><h3 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h3><p>Primero modificamos app.js para que haga uso del modelo que hemos creado. Una vez más haciendo uso de inject.</p><p><img src="/images/2015-07/app-js2.png" alt="app.js modificado"></p><p>Como ves, utilizamos la función all proporcionada por el modelo. Una vez se resuelve la promesa, extraemos los títulos de las películas de la respuesta y los guardamos en this.movies.</p><h3 id="app-html"><a href="#app-html" class="headerlink" title="app.html"></a>app.html</h3><p>Ahora tenemos que tomar esas pelis y enseñarlas. Para ello modificamos la vista:</p><p><img src="/images/2015-07/viewmodified.png" alt="vista modificada"></p><p>En este caso utilizamos el atributo repeat.for, para recorrer el objeto movies y extraer el título de cada una.</p><p>Finalmente el resultado es este:</p><p><img src="/images/2015-07/result.png" alt="resultado"></p><p>Sí, ya sé que no es lo más bonito del mundo (y ahora que me doy cuenta, ¡ni siquiera salen por orden!), pero ya lo corregiremos más adelante con un poco de Bootstrap.</p><hr><h2 id="En-resumen"><a href="#En-resumen" class="headerlink" title="En resumen"></a>En resumen</h2><p>En este post hemos aprendido a:</p><ul><li><strong>Crear una aplicación de Aurelia desde cero</strong>, usando JSPM para instalar las dependencias que necesitamos.</li><li>Qué es MVVM y <strong>cómo crear <em>models</em>, <em>views</em> y <em>viewmodels</em> y usarlos</strong> dentro de Aurelia.</li><li>Cómo <strong>utilizar la inyección de dependencias para modularizar los componentes</strong> de la aplicación.</li></ul><p>Lo que mola de esto, en mi opinión, es que con pocas excepciones, <strong>hemos estado usando estándares HTML5 y JS (ECMAScript 2015)</strong>. Lo cual está muy bien porque hay que aprenderlos sí o sí :)</p><hr><p>Por cierto.</p><p>En este post he cambiado un poquitillo la manera de trabajar, incluyendo imágenes en lugar de trozos de código. He hecho esto porque creo que se ve mejor con el árbol de directorios y queda todo más legible. Además <strong>el código lo tienes en el <a href="https://github.com/er1x/aur-tuto">repositorio en Github</a></strong>, para copiar lo que quieras.</p><p>Supongo que me penalizará el SEO, pero si te es más útil así, bien hecho está.</p><p>Si prefieres que ponga el código en como texto, dímelo y para los sucesivos posts lo haré así.</p><p>Y si quieres comentar algo sobre Aurelia, eres bienvenido ^^</p><h2><a href="#" class="headerlink"></a><br></h2><p>Imagen del post por <a href="http://jaymantri.com/" target="_blank" rel="external">Jay Mantri</a> | Creative Commons 0 <a href="http://creativecommons.org/publicdomain/zero/1.0/" target="_blank" rel="external">CC0</a></p></div></article></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Que-es-Model-View-ViewModel"><span class="toc-number">1.</span> <span class="toc-text">Qué es Model-View-ViewModel</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creando-el-proyecto"><span class="toc-number">2.</span> <span class="toc-text">Creando el proyecto</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Agregando-JSPM-al-proyecto"><span class="toc-number">2.1.</span> <span class="toc-text">Agregando JSPM al proyecto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Instalando-Aurelia"><span class="toc-number">2.2.</span> <span class="toc-text">Instalando Aurelia</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Primeros-ViewModel-y-View"><span class="toc-number">3.</span> <span class="toc-text">Primeros ViewModel y View</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Cargando-el-framework"><span class="toc-number">3.1.</span> <span class="toc-text">Cargando el framework</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Primeros-view-y-viewmodel"><span class="toc-number">3.2.</span> <span class="toc-text">Primeros view y viewmodel</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#¿Y-el-model"><span class="toc-number">4.</span> <span class="toc-text">¿Y el model?</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Vale-pero-¿a-que-viene-lo-del-inject"><span class="toc-number">4.1.</span> <span class="toc-text">Vale, pero, ¿a qué viene lo del inject?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Modificando-App"><span class="toc-number">5.</span> <span class="toc-text">Modificando App</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#app-js"><span class="toc-number">5.1.</span> <span class="toc-text">app.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#app-html"><span class="toc-number">5.2.</span> <span class="toc-text">app.html</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#En-resumen"><span class="toc-number">6.</span> <span class="toc-text">En resumen</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#undefined"><span class="toc-number">7.</span> <span class="toc-text"></span></a></li></ol></div><div id="actions-footer"><ul><li id="toc"><a class="icon" href="#actions-footer"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li><li id="top" style="display:none"><a class="icon" href="#"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li><li id="menu"><a class="icon" href="#actions-footer"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li></ul></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2018 Emilio J. Grande</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></nav></div></footer><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/lib/meslo-LG/styles.css"><link rel="stylesheet" href="/css/style.css"><script src="/js/main.js"></script></body></html>