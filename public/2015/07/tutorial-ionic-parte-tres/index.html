<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Aquí llega la última parte del tutorial de Ionic. Si te leíste las otras partes sabrás que estamos creando una aplicación híbrida con el framework Ionic. Esta aplicación permitirá obtener un listado d"><meta name="keywords" content="cordova,ionic,angularjs"><meta property="og:type" content="article"><meta property="og:title" content="Tutorial Ionic Framework - Parte 3: Autenticación con Twitter y conexión al backend"><meta property="og:url" content="https://github.com/er1x/2015/07/tutorial-ionic-parte-tres/index.html"><meta property="og:site_name" content="Emilio J. Grande | Web Developer"><meta property="og:description" content="Aquí llega la última parte del tutorial de Ionic. Si te leíste las otras partes sabrás que estamos creando una aplicación híbrida con el framework Ionic. Esta aplicación permitirá obtener un listado d"><meta property="og:locale" content="default"><meta property="og:image" content="https://github.com/images/2015-06/ionic.png"><meta property="og:image" content="https://github.com/images/2015-07/genymotion1.png"><meta property="og:image" content="https://github.com/images/2015-07/genymotion2.png"><meta property="og:updated_time" content="2017-03-11T12:54:27.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Tutorial Ionic Framework - Parte 3: Autenticación con Twitter y conexión al backend"><meta name="twitter:description" content="Aquí llega la última parte del tutorial de Ionic. Si te leíste las otras partes sabrás que estamos creando una aplicación híbrida con el framework Ionic. Esta aplicación permitirá obtener un listado d"><meta name="twitter:image" content="https://github.com/images/2015-06/ionic.png"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>Tutorial Ionic Framework - Parte 3: Autenticación con Twitter y conexión al backend</title></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" style="display:none"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></span><br><div id="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Poniendonos-en-contexto"><span class="toc-number">1.</span> <span class="toc-text">Poniéndonos en contexto</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Index-html"><span class="toc-number">2.</span> <span class="toc-text">Index.html</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#app-js"><span class="toc-number">3.</span> <span class="toc-text">app.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#services-js"><span class="toc-number">4.</span> <span class="toc-text">services.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#controllers-js"><span class="toc-number">5.</span> <span class="toc-text">controllers.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Agregando-la-plataforma-movil"><span class="toc-number">6.</span> <span class="toc-text">Agregando la plataforma móvil</span></a></li></ol></div></span></div><div class="content index width mx-auto px2 my4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Tutorial Ionic Framework - Parte 3: Autenticación con Twitter y conexión al backend</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Emilio J. Grande | Web Developer</span></span><div class="postdate">&nbsp;<time datetime="2015-07-05T18:22:00.000Z" itemprop="datePublished">05-07-2015</time></div><div class="article-tag"><i class="fa fa-tag"></i> <a class="tag-link" href="/tags/angularjs/">angularjs</a>, <a class="tag-link" href="/tags/cordova/">cordova</a>, <a class="tag-link" href="/tags/ionic/">ionic</a></div></div></header><div class="content" itemprop="articleBody"><p><img src="/images/2015-06/ionic.png" alt="ionic"></p><p>Aquí llega la última parte del tutorial de Ionic. Si te leíste las otras partes sabrás que <strong>estamos creando una aplicación híbrida con el <a href="http://ionicframework.com/" target="_blank" rel="external">framework Ionic</a></strong>. Esta aplicación permitirá obtener un listado de eventos y autenticarse mediante Twitter.</p><p>Recordemos primero lo que llevamos hecho hasta el momento:</p><ul><li>En la <a href="/2015/06/tutorial-ionic-parte-uno/">parte 1</a> instalamos Ionic, creamos la App y vimos la estructura de una aplicación por dentro. También la dejamos lista con las vistas, controladores y servicios necesarios.</li><li>En la <a href="/2015/06/tutorial-ionic-parte-dos/">parte 2</a> te enseñé cómo crear un backend en Node.js que permitiera realizar autenticación con token mediante la API de Twitter.</li></ul><p>En este último post de la serie <strong>vamos a ver cómo conectar la aplicación al backend</strong> y que permita:</p><ul><li>Autenticarnos.</li><li>Obtener una lista de eventos.</li></ul><p>Y, finalmente, <strong>utilizaremos un emulador de Android para ver cómo funcionaría la aplicación</strong>.</p><h2 id="Poniendonos-en-contexto"><a href="#Poniendonos-en-contexto" class="headerlink" title="Poniéndonos en contexto"></a>Poniéndonos en contexto</h2><p>Vamos a tomar el código de la aplicación Ionic y a ponernos donde lo habíamos dejado en la parte 1.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> https://github.com/er1x/events-app</div><div class="line"><span class="built_in">cd</span> events-app</div><div class="line">git checkout part1</div><div class="line">ionic serve</div></pre></td></tr></table></figure><p>Aparte de eso, tendremos que arrancar el backend (orden <em>node server.js</em>, en el directorio donde tengas el backend de la <a href="/2015/06/tutorial-ionic-parte-dos/">segunda parte del tutorial</a>).</p><p>El backend lo puedes clonar de <a href="https://github.com/er1x/events-backend">este repositorio</a>, pero recuerda que para que funcione necesitas crear un App en Twitter y crear un fichero <em>.secret.json</em> con las credenciales.</p><h2 id="Index-html"><a href="#Index-html" class="headerlink" title="Index.html"></a>Index.html</h2><p>Lo primero que tenemos que hacer es instalar el plugin que nos permitirá autenticar, <a href="https://github.com/sahat/satellizer">Satellizer</a>. <strong>En el repositorio del proyecto ya te lo he incluido</strong>, pero puedes instalarlo de nuevo <a href="/2015/05/dependencias-web/#Bower">utilizando Bower</a>, que ya viene preparado con Ionic. En el momento de escribir este post el plugin tiene un problema con Twitter, y por eso he incluido la versión arreglada de la rama master.</p><p>Satellizer soporta autenticación por token con las redes sociales más conocidas, además de permitirnos autenticar con un sistema de autenticación propio.</p><p>Una vez lo tenemos agregado, <strong>actualizamos el fichero index.html</strong>:<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">...</div><div class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"Content-Security-Policy"</span> <span class="attr">content</span>=<span class="string">"default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'"</span>&gt;</span></div><div class="line">...</div><div class="line"><span class="comment">&lt;!-- ionic/angularjs js --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"lib/ionic/js/ionic.bundle.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"lib/satellizer/satellizer.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- cordova script (this will be a 404 during development) --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"cordova.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure><p></p><p>Como puedes ver, hemos incluido una etiqueta META, necesaria para que funcione la autenticación con Cordova. Y además el fichero JS de Satellizer.</p><h2 id="app-js"><a href="#app-js" class="headerlink" title="app.js"></a>app.js</h2><p>Una vez agregada la referencia en el index.html tenemos que <strong>añadir Satellizer a las dependencias de nuestra aplicación Angular y configurarlo</strong>. Así que editamos app.js:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'eventsApp'</span>, [ <span class="string">'ionic'</span>,</div><div class="line">                              <span class="string">'eventsApp.controllers'</span>,</div><div class="line">                              <span class="string">'eventsApp.services'</span>,</div><div class="line">                              <span class="string">'satellizer'</span>])</div><div class="line"></div><div class="line">.config(<span class="function"><span class="keyword">function</span>(<span class="params">$authProvider</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> cfg = &#123;</div><div class="line">    <span class="attr">popupOptions</span>: &#123;</div><div class="line">      <span class="attr">location</span>: <span class="string">'no'</span>,</div><div class="line">      <span class="attr">toolbar</span>: <span class="string">'no'</span>,</div><div class="line">      <span class="attr">width</span>: <span class="built_in">window</span>.screen.width,</div><div class="line">      <span class="attr">height</span>: <span class="built_in">window</span>.screen.height</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">url</span>: <span class="string">'/auth/twitter'</span></div><div class="line">  &#125;;</div><div class="line"></div><div class="line">  $authProvider.baseUrl = <span class="string">'http://192.168.0.100:8000'</span>;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (ionic.Platform.isIOS() || ionic.Platform.isAndroid()) &#123;</div><div class="line">    $authProvider.platform   = <span class="string">'mobile'</span>;</div><div class="line">    cfg.redirectUri          = <span class="string">'http://127.0.0.1/'</span>;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    $authProvider.withCredentials = <span class="literal">false</span>;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  $authProvider.twitter(cfg);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">.config(<span class="function"><span class="keyword">function</span>(<span class="params">$stateProvider, $urlRouterProvider</span>) </span>&#123;</div><div class="line">...</div></pre></td></tr></table></figure><p>Verás que, dependiendo de si la aplicación se ejecuta en Cordova o en un navegador normal, se redirige a una URL diferente tras la autenticación. Por otra parte, <strong>tendrás que modificar la baseUrl a la URL donde tengas escuchando el backend de Node</strong>.</p><h2 id="services-js"><a href="#services-js" class="headerlink" title="services.js"></a>services.js</h2><p>El servicio que teníamos en <strong>services.js</strong> ya no tendrá <em>hardcodeados</em> los eventos, sino que <strong>los obtendrá del backend, usando para ello el servicio <a href="https://docs.angularjs.org/api/ng/service/$http" target="_blank" rel="external">$http</a> de AngularJS</strong>.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'eventsApp.services'</span>, [])</div><div class="line"></div><div class="line">.factory(<span class="string">'EventsService'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$http</span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">all</span>: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="keyword">return</span> $http.get(<span class="string">'http://192.168.0.100:8000/events'</span>);</div><div class="line">    &#125;</div><div class="line">  &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><h2 id="controllers-js"><a href="#controllers-js" class="headerlink" title="controllers.js"></a>controllers.js</h2><p>Este es el aspecto que presenta ahora el fichero <strong>controllers.js</strong>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">angular.module(<span class="string">'eventsApp.controllers'</span>, [])</div><div class="line"></div><div class="line">.controller(<span class="string">'LoginCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, $auth, $state</span>)</span>&#123;</div><div class="line">  $scope.authenticate = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    $auth.authenticate(<span class="string">'twitter'</span>)</div><div class="line">         .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">           $state.go(<span class="string">'tab.list'</span>);</div><div class="line">         &#125;)</div><div class="line">         .catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(err);</div><div class="line">         &#125;);</div><div class="line">  &#125;;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">.controller(<span class="string">'ListCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, EventsService, $auth, $state</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (!$auth.isAuthenticated()) &#123;</div><div class="line">    $state.go(<span class="string">'login'</span>);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    EventsService.all()</div><div class="line">    .success(<span class="function"><span class="keyword">function</span>(<span class="params">events</span>)</span>&#123;</div><div class="line">      $scope.events = events;</div><div class="line">    &#125;)</div><div class="line">    .error(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">      <span class="built_in">console</span>.log(err);</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">.controller(<span class="string">'AccountCtrl'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, $auth, $state</span>) </span>&#123;</div><div class="line">  $scope.logout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    $auth.logout();</div><div class="line">    $state.go(<span class="string">'login'</span>);</div><div class="line">  &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>Aquí se hace lo siguiente:</p><ul><li><p>En los tres controladores <strong>inyectamos las dependencias $auth</strong> (proporcionada por Satellizer) <strong>y $state</strong> (proporcionada por el router de Ionic).</p></li><li><p>En el controlador de Login, <strong>definimos la función que se ejecuta al hacer click en el botón</strong>. Esta función utiliza Satellizer para autenticar con Twitter y, si la autenticación es exitosa, redirige al usuario a la lista de eventos usando $state.</p></li><li><p>El <strong>controlador de la lista utiliza $auth para comprobar si el usuario está autenticado</strong>, si es así se utiliza el servicio para listar los eventos, y si no se redirige al usuario a la pantalla de Login.</p></li><li><p>Por último, <strong>el controlador de cuenta define una función para que el usuario pueda cerrar la sesión</strong>.</p></li></ul><hr><p>Con esto la aplicación ya está lista para funcionar en el navegador, pero nosotros queremos desplegarla en un dispositivo móvil, así que vamos a ello.</p><h2 id="Agregando-la-plataforma-movil"><a href="#Agregando-la-plataforma-movil" class="headerlink" title="Agregando la plataforma móvil"></a>Agregando la plataforma móvil</h2><p>En este ejemplo voy a usar Android, pero en principio debería funcionar sin problemas en otras plataformas.</p><p>Para ello <strong>agregamos el soporte para Android y agregamos el plugin inapp-browser</strong>, necesario para que funcione la autenticación.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ionic platform add android</div><div class="line">ionic plugin add cordova-plugin-inappbrowser</div></pre></td></tr></table></figure><p>Por último construimos y corremos la aplicación. Yo utilizo el emulador <a href="https://www.genymotion.com/#!/" target="_blank" rel="external">Genymotion</a>, que va superbien y le da mil vueltas al emulador estándar de Android.</p><p>No te voy a explicar aquí como instalar Genymotion, pero vamos, que es muy sencillo y en Google encuentras información a patadas sobre ello.</p><p>Con ello, el SDK de Android instalado y Genymotion corriendo, ejecutamos:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ionic run android</div></pre></td></tr></table></figure><p>Este comando compila e instala la aplicación en un dispositivo conectado, en este caso el emulador de Android.</p><div class="container" style="width:100%"><br><div class="theme-table-image col-sm-6"><br><img src="/images/2015-07/genymotion1.png" alt="genymotion1"><br></div><br><div class="theme-table-image col-sm-6"><br><img src="/images/2015-07/genymotion2.png" alt="genymotion2"><br></div><br></div><hr><p>¿Fácil no?</p><p>En este post hemos visto <strong>cómo utilizar Satellizer para iniciar sesión con Twitter</strong> y <strong>cómo utilizar el servicio $http de AngularJS para recuperar información de un servidor remoto</strong>.</p><p>En mi opinión las aplicaciones híbridas crecerán en los próximos años como alternativa de desarrollo rápido y menor coste. Y frameworks como Ionic son una buena solución.</p><p><strong>¿Qué opinas tú al respecto de este tipo de alternativas al desarrollo nativo?</strong></p></div></article></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Poniendonos-en-contexto"><span class="toc-number">1.</span> <span class="toc-text">Poniéndonos en contexto</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Index-html"><span class="toc-number">2.</span> <span class="toc-text">Index.html</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#app-js"><span class="toc-number">3.</span> <span class="toc-text">app.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#services-js"><span class="toc-number">4.</span> <span class="toc-text">services.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#controllers-js"><span class="toc-number">5.</span> <span class="toc-text">controllers.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Agregando-la-plataforma-movil"><span class="toc-number">6.</span> <span class="toc-text">Agregando la plataforma móvil</span></a></li></ol></div><div id="actions-footer"><ul><li id="toc"><a class="icon" href="#actions-footer"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li><li id="top" style="display:none"><a class="icon" href="#"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li><li id="menu"><a class="icon" href="#actions-footer"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li></ul></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2018 Emilio J. Grande</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></nav></div></footer><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/lib/meslo-LG/styles.css"><link rel="stylesheet" href="/css/style.css"><script src="/js/main.js"></script></body></html>