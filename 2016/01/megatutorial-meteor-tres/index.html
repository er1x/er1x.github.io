<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Esta es la tercera parte de la serie de tutoriales de Meteor.Las partes de este tutorial son:Parte 1: el hola mundo de Meteor y la estructura de un proyecto.Parte 2: cómo crear vistas y rutas e introd"><meta property="og:type" content="article"><meta property="og:title" content="Megatutorial Meteor en Español (3) - El framework más popular en Github"><meta property="og:url" content="https://github.com/er1x/2016/01/megatutorial-meteor-tres/index.html"><meta property="og:site_name" content="Emilio J. Grande | Web Developer"><meta property="og:description" content="Esta es la tercera parte de la serie de tutoriales de Meteor.Las partes de este tutorial son:Parte 1: el hola mundo de Meteor y la estructura de un proyecto.Parte 2: cómo crear vistas y rutas e introd"><meta property="og:image" content="https://github.com/er1x/images/2015-12/meteor.jpg"><meta property="og:image" content="https://github.com/er1x/images/2016-01/meteor-mongo.png"><meta property="og:image" content="https://github.com/er1x/images/2016-01/mongo-insert.png"><meta property="og:image" content="https://github.com/er1x/images/2016-01/productos-cliente.png"><meta property="og:image" content="https://github.com/er1x/images/2016-01/no-autopublish.png"><meta property="og:image" content="https://github.com/er1x/images/2016-01/products-subscribed.png"><meta property="og:image" content="https://github.com/er1x/images/2016-01/client-insertion.png"><meta property="og:image" content="https://github.com/er1x/images/2016-01/insert-denied.png"><meta property="og:updated_time" content="2017-03-06T15:41:47.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Megatutorial Meteor en Español (3) - El framework más popular en Github"><meta name="twitter:description" content="Esta es la tercera parte de la serie de tutoriales de Meteor.Las partes de este tutorial son:Parte 1: el hola mundo de Meteor y la estructura de un proyecto.Parte 2: cómo crear vistas y rutas e introd"><meta name="twitter:image" content="https://github.com/er1x/images/2015-12/meteor.jpg"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>Megatutorial Meteor en Español (3) - El framework más popular en Github</title><style type="text/css">.content h1,.fa,body{-moz-osx-font-smoothing:grayscale}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased}.content h1,.content h2,.content strong{font-weight:700}body,pre{font-family:Menlo,"Meslo LG",monospace}.fa-lg{font-size:1.33333333em;line-height:.75em;vertical-align:-15%}.fa-tag:before{content:"\f02b"}.fa-list:before{content:"\f03a"}.fa-chevron-up:before{content:"\f077"}.fa-bars:before{content:"\f0c9"}#header-post #toc .toc-level-2:before,.article-tag .tag-link:before,article .content h2:before{content:"#"}*,:after,:before{box-sizing:border-box}.content h1,body{-webkit-font-smoothing:antialiased}.my4{margin-top:4rem;margin-bottom:4rem}.mx-auto{margin-left:auto;margin-right:auto}.px2{padding-left:1rem;padding-right:1rem}.content h1{letter-spacing:.01em;font-size:1.5em;font-style:normal;color:#2bbc8a;margin-top:3rem;margin-bottom:1rem;display:block}.content h2{position:relative;font-size:1rem;text-transform:none;letter-spacing:normal;margin-top:2rem;margin-bottom:.5rem;color:#eee;display:block}#header-post #nav ul li{border-right:1px dotted #2bbc8a}.content em{font-style:italic}.content ul,body{line-height:1.725}.content td{border-bottom:none;padding:9px 8px 0}html{height:100%;border-top:2px solid #c9cacc}body{text-rendering:geometricPrecision;color:#c9cacc;background-color:#1d1f21;font-size:14px;font-weight:400;min-height:100%;display:flex;flex-direction:column}.content{flex:1}.content p{-moz-hyphens:auto;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.content pre{-moz-hyphens:manual;-ms-hyphens:manual;-webkit-hyphens:manual;hyphens:manual}.content a{text-decoration:none;color:#c9cacc;background-repeat:repeat-x;background-position:bottom;background-size:100% 6px;background-image:linear-gradient(transparent,transparent 5px,#c9cacc 5px,#c9cacc)}#header-post a,.content h2 a{color:inherit;background:0 0;text-decoration:none}#header-post #nav ul li:last-child a,#header-post ul li:last-child{margin-right:0}.width{width:100%;max-width:39rem}@media (max-width:480px){.my4{margin-top:2rem;margin-bottom:2rem}}#header-post #nav ul{line-height:15px}#header-post #nav{font-style:normal;font-weight:200;letter-spacing:.01em;font-size:.8rem;color:#2bbc8a}#header-post{position:fixed;top:2rem;right:2rem;display:inline-block;float:right}#header-post ol{list-style-type:none}#header-post ul{list-style-type:none;margin:0;padding:0;display:inline-block}#header-post ul li{margin-right:15px;display:inline-block;vertical-align:middle}#header-post #menu-icon,#header-post #menu-icon-tablet{float:right;margin-left:15px}#header-post #top-icon-tablet{margin-left:15px;bottom:2rem;right:2rem;position:fixed}#header-post #menu{visibility:hidden}#header-post #nav ul a{margin-right:15px;color:color-accent}#header-post #nav ul li:last-child{border-right:0;margin-right:0}#header-post #toc{clear:both;text-align:right;padding-top:1rem}#header-post #toc .toc-number{display:none}#header-post #toc .toc-level-2{font-size:.8rem;color:#c9cacc}#header-post #toc .toc-level-2:before{color:#2bbc8a}#header-post #toc .toc-level-3{font-size:.7rem;color:#b3b3b3}#header-post #toc .toc-level-4{font-size:.4rem;color:#666}@media screen and (max-width:500px){#header-post{display:none}}@media screen and (max-width:900px){#header-post #menu-icon{display:none}}@media screen and (max-width:1199px){#header-post #toc{display:none}}@media screen and (min-width:900px){#header-post #menu-icon-tablet,#header-post #top-icon-tablet{display:none!important}}#footer-post{bottom:0;left:0;right:0;position:fixed;width:100%;z-index:5000000;background:#212326;border-top:1px solid #666673}#footer-post a,#footer-post a.icon,.highlight pre{background:0 0}#footer-post a{color:inherit;text-decoration:none}#footer-post #nav-footer{margin-left:1rem;margin-right:1rem;text-align:center}#footer-post #nav-footer a{color:#2bbc8a;font-size:1rem}#footer-post #actions-footer ul,#footer-post #nav-footer ul{list-style-type:none;margin:0;padding:0;display:table;width:100%}#footer-post #nav-footer ul li{display:inline-table;width:20%;padding:10px;vertical-align:middle}#footer-post #actions-footer{text-align:center;margin-top:1rem;margin-bottom:1rem;width:100%}#footer-post #actions-footer a{color:#2bbc8a}#footer-post #actions-footer ul li{display:table-cell;vertical-align:middle}#footer-post #toc-footer .toc-level-4,#footer-post #toc-footer .toc-number{display:none}#footer-post #toc-footer{clear:both;text-align:left;padding-top:1rem}#footer-post #toc-footer ol{list-style-type:none;padding-left:20px}#footer-post #toc-footer ol li{line-height:30px}#footer-post #toc-footer .toc-level-2{font-size:.8rem;color:#c9cacc}#footer-post #toc-footer .toc-level-2:before{content:"#";color:#2bbc8a}#footer-post #toc-footer .toc-level-3{font-size:.7rem;color:#666;line-height:15px}@media screen and (min-width:500px){#footer-post-container{display:none}}article header .posttitle{margin-top:0;margin-bottom:0;text-transform:none;font-size:1.5em;line-height:1.25}article header .meta{margin-top:0;margin-bottom:1rem}article header .meta *{color:#ccc;font-size:.85rem}article header .author{text-transform:uppercase;letter-spacing:.01em;font-weight:700}article header .postdate{display:inline}article .content h2:before{color:#2bbc8a;position:absolute;left:-1rem;top:-4px;font-size:1.2rem;font-weight:700}article .content img{max-width:100%;height:auto;display:block;margin:auto}.posttitle{text-transform:none;font-size:1.5em;line-height:1.25}@media (min-width:480px){p{text-align:justify}.article-tag{display:inline}.article-tag:before{content:"|"}}pre{overflow-x:auto;font-size:13px;padding:10px 15px 0;line-height:22px;-webkit-border-radius:4px;border-radius:4px;border:1px dotted #666}.highlight pre{padding:0;border:none}.highlight td.gutter{text-align:right;padding-right:20px;display:none}</style></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" style="display:none"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></span><br><div id="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-el-almacen-de-datos"><span class="toc-number">1.</span> <span class="toc-text">MongoDB, el almacén de datos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creando-una-coleccion"><span class="toc-number">2.</span> <span class="toc-text">Creando una colección</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lib-collections-products-js"><span class="toc-number">2.1.</span> <span class="toc-text">lib/collections/products.js</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Disponibilidad-de-los-datos-y-Sincronizacion-automatica"><span class="toc-number">3.</span> <span class="toc-text">Disponibilidad de los datos y Sincronización automática</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Publish-Subscribe"><span class="toc-number">3.1.</span> <span class="toc-text">Publish / Subscribe</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#server-publications-js"><span class="toc-number">3.1.1.</span> <span class="toc-text">server/publications.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#client-scripts-subscriptions-js"><span class="toc-number">3.1.2.</span> <span class="toc-text">client/scripts/subscriptions.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Insecure"><span class="toc-number">3.2.</span> <span class="toc-text">Insecure</span></a></li></ol></li></ol></div></span></div><div class="content index width mx-auto px2 my4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Megatutorial Meteor en Español (3) - El framework más popular en Github</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Emilio J. Grande | Web Developer</span></span><div class="postdate"><time datetime="2016-01-18T06:00:00.000Z" itemprop="datePublished">18-01-2016</time></div><div class="article-tag"><i class="fa fa-tag"></i> <a class="tag-link" href="/tags/meteor/">meteor</a></div></div></header><div class="content" itemprop="articleBody"><p><img src="/images/2015-12/meteor.jpg" alt="Meteor"></p><p>Esta es la <strong>tercera parte de la serie de tutoriales de <a href="https://www.meteor.com/" target="_blank" rel="external">Meteor</a></strong>.</p><p>Las partes de este tutorial son:</p><ul><li><a href="/2015/12/megatutorial-meteor-uno/">Parte 1</a>: el <em>hola mundo</em> de Meteor y la estructura de un proyecto.</li><li><a href="/2016/01/megatutorial-meteor-dos/">Parte 2</a>: cómo crear vistas y rutas e introducción a <a href="http://atmospherejs.com/" target="_blank" rel="external">Atmosphere</a>.</li><li><a href="/2016/01/megatutorial-meteor-tres/">Parte 3</a>: las colecciones de datos.</li><li><a href="/2016/02/megatutorial-meteor-cuatro/">Parte 4</a>: usuarios y autenticación.</li><li><a href="/2016/02/megatutorial-meteor-cinco/">Parte 5</a>: llamadas a métodos en el servidor.</li></ul><p>En esta tercera parte del tutorial veremos:</p><ul><li>La base de datos de Meteor.</li><li>Cómo crear colecciones de datos.</li><li>Cómo hacer que esos datos estén disponibles en el <em>frontend</em>.</li><li>El modelo de seguridad de Meteor.</li></ul><p>A por ello.</p><h2 id="MongoDB-el-almacen-de-datos"><a href="#MongoDB-el-almacen-de-datos" class="headerlink" title="MongoDB, el almacén de datos"></a>MongoDB, el almacén de datos</h2><p><strong>Meteor utiliza <a href="https://www.mongodb.org/" target="_blank" rel="external">MongoDB</a> como base de datos</strong>. Como seguramente sepas, MongoDB es una base de datos NoSQL orientada a almacenar documentos, concretamente documentos tipo JSON (MongoDB llama a este formato <a href="https://es.wikipedia.org/wiki/BSON" target="_blank" rel="external">BSON</a>).</p><p>Es, probablemente, la base de datos NoSQL más popular hoy en día.</p><p><strong>Meteor viene con un MongoDB empaquetado</strong> que se puede usar directamente desde el directorio del proyecto, utilizando el comando <strong>meteor mongo</strong>, así:</p><p><img src="/images/2016-01/meteor-mongo.png" alt="meteor-mongo"></p><h2 id="Creando-una-coleccion"><a href="#Creando-una-coleccion" class="headerlink" title="Creando una colección"></a>Creando una colección</h2><p>En MongoDB, los datos se almacenan en colecciones.</p><p>Si recuerdas del anterior tutorial, habíamos <a href="/2016/01/megatutorial-meteor-dos/#Una_lista_de_productos_3A_a_lo_burro">creado previamente un listado <em>hardcodeado</em> de productos</a>.</p><p>Vamos a sustituir este array que habíamos creado manualmente, por una colección Meteor:</p><h3 id="lib-collections-products-js"><a href="#lib-collections-products-js" class="headerlink" title="lib/collections/products.js"></a>lib/collections/products.js</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Products = <span class="keyword">new</span> Meteor.Collection(<span class="string">'products'</span>);</div></pre></td></tr></table></figure><p>Tan sencillo como eso.</p><p>Insertaremos a continuación los productos que antes teníamos en un array en la base de datos, utilizando el mismo cliente de Mongo de consola:</p><p><img src="/images/2016-01/mongo-insert.png" alt="Insertando en MongoDB"></p><h2 id="Disponibilidad-de-los-datos-y-Sincronizacion-automatica"><a href="#Disponibilidad-de-los-datos-y-Sincronizacion-automatica" class="headerlink" title="Disponibilidad de los datos y Sincronización automática"></a>Disponibilidad de los datos y Sincronización automática</h2><p>La colección Products, al estar en la carpeta lib, está disponible tanto en el servidor como en el cliente, y Meteor los sincroniza de forma transparente.</p><p>La gracia de esto es que Meteor ofrece una <strong>interfaz similar a MongoDB, llamada <a href="https://www.meteor.com/mini-databases" target="_blank" rel="external">MiniMongo</a></strong>, pero que se puede usar en el cliente. Esto en realidad es una copia de la colección cacheada en el navegador (y no entera, evidentemente).</p><p>Mira el aspecto de Products en cliente:</p><p><img src="/images/2016-01/productos-cliente.png" alt="Colección Products en el navegador"></p><p>Si se realizan inserciones y actualizaciones, Meteor actualizará las vistas automáticamente en el navegador mediante Blaze.</p><h3 id="Publish-Subscribe"><a href="#Publish-Subscribe" class="headerlink" title="Publish / Subscribe"></a>Publish / Subscribe</h3><p>Por defecto Meteor comparte todas las colecciones con el cliente mediante el paquete <em><a href="https://atmospherejs.com/meteor/autopublish" target="_blank" rel="external">autopublish</a></em>. Esto no es deseable, y en producción debemos eliminarlo:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">meteor remove autopublish</div></pre></td></tr></table></figure><p>El problema es que ahora, ¡nos hemos quedado sin productos!</p><p><img src="/images/2016-01/no-autopublish.png" alt="Sin productos"></p><p>No hay problema, lo que vamos a hacer es <strong>publicar</strong>, los productos.</p><h4 id="server-publications-js"><a href="#server-publications-js" class="headerlink" title="server/publications.js"></a>server/publications.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Meteor.publish(<span class="string">'products'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> Products.find();</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>Y debemos indicar al cliente que se <strong>suscriba</strong> a este dato:</p><h4 id="client-scripts-subscriptions-js"><a href="#client-scripts-subscriptions-js" class="headerlink" title="client/scripts/subscriptions.js"></a>client/scripts/subscriptions.js</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Meteor.subscribe(<span class="string">'products'</span>);</div></pre></td></tr></table></figure><p>¡Ya tenemos de vuelta los productos!</p><p><img src="/images/2016-01/products-subscribed.png" alt="Listado de productos con suscripción"></p><h3 id="Insecure"><a href="#Insecure" class="headerlink" title="Insecure"></a>Insecure</h3><p>Puede que al ver que el cliente puede acceder a los productos hayas pensado: “Pero… ¿el cliente puede escribir en la base de datos?”</p><p>¡Pues sí!</p><p>Mira lo que pasa si hago una inserción desde el navegador:</p><p><img src="/images/2016-01/client-insertion.png" alt="Insertando un producto falso"></p><p>No mola, ¿verdad? ¡El cliente podría echar a perder la aplicación!</p><p>Esto ocurre porque <strong>Meteor incluye un paquete llamado <a href="https://atmospherejs.com/meteor/insecure" target="_blank" rel="external"><em>insecure</em></a>, útil para prototipar, pero peligroso en producción</strong>. Vamos a quitarlo:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">meteor remove insecure</div></pre></td></tr></table></figure><p>Si probamos ahora…</p><p><img src="/images/2016-01/insert-denied.png" alt="Inserción denegada"></p><p>Podemos personalizar lo que se puede y no se puede hacer en una colección mediante los métodos <a href="http://docs.meteor.com/#/full/allow" target="_blank" rel="external">allow y deny</a>.</p><p>Imagina que por un casual quisiéramos permitir inserciones como la que has visto antes, podrías hacer:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Products.allow(&#123;</div><div class="line">  <span class="attr">insert</span>: <span class="function"><span class="keyword">function</span>(<span class="params">userId, disconnect</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><hr><p>Como ves, es bastante sencillo almacenar datos de una aplicación en Meteor, por medio de MongoDB, así como hacer que estos datos estén disponibles para el cliente, aplicando modelos de seguridad personalizados.</p><p>En el próximo tutorial veremos cómo autenticar a los usuarios y añadir productos a un carrito. ¡No te lo pierdas!</p></div></article></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#MongoDB-el-almacen-de-datos"><span class="toc-number">1.</span> <span class="toc-text">MongoDB, el almacén de datos</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Creando-una-coleccion"><span class="toc-number">2.</span> <span class="toc-text">Creando una colección</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lib-collections-products-js"><span class="toc-number">2.1.</span> <span class="toc-text">lib/collections/products.js</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Disponibilidad-de-los-datos-y-Sincronizacion-automatica"><span class="toc-number">3.</span> <span class="toc-text">Disponibilidad de los datos y Sincronización automática</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Publish-Subscribe"><span class="toc-number">3.1.</span> <span class="toc-text">Publish / Subscribe</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#server-publications-js"><span class="toc-number">3.1.1.</span> <span class="toc-text">server/publications.js</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#client-scripts-subscriptions-js"><span class="toc-number">3.1.2.</span> <span class="toc-text">client/scripts/subscriptions.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Insecure"><span class="toc-number">3.2.</span> <span class="toc-text">Insecure</span></a></li></ol></li></ol></div><div id="actions-footer"><ul><li id="toc"><a class="icon" href="#actions-footer"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li><li id="top" style="display:none"><a class="icon" href="#"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li><li id="menu"><a class="icon" href="#actions-footer"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li></ul></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2017 Emilio J. Grande</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></nav></div></footer><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/lib/meslo-LG/styles.css"><link rel="stylesheet" href="/css/style.css"><script src="/js/main.js"></script></body></html>