<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Casi a diario tengo que trabajar con mapas dentro de aplicaciones de Angular, así que he decidido hacer un breve tutorial sobre ello.Para el ejemplo vamos a suponer que tenemos que hacer una app para"><meta name="keywords" content="ionic"><meta property="og:type" content="article"><meta property="og:title" content="Cómo añadir un mapa a una app híbrida en Ionic"><meta property="og:url" content="https://github.com/er1x/2016/05/mapas-en-app-hibrida-ionic/index.html"><meta property="og:site_name" content="Emilio J. Grande | Web Developer"><meta property="og:description" content="Casi a diario tengo que trabajar con mapas dentro de aplicaciones de Angular, así que he decidido hacer un breve tutorial sobre ello.Para el ejemplo vamos a suponer que tenemos que hacer una app para"><meta property="og:locale" content="default"><meta property="og:image" content="https://github.com/images/2016-05/RoadTrip.jpg"><meta property="og:image" content="https://github.com/images/2016-05/pizzas1.png"><meta property="og:image" content="https://github.com/images/2016-05/pizzas2.png"><meta property="og:image" content="https://github.com/images/2016-05/pizzas3.png"><meta property="og:image" content="https://github.com/images/2016-05/pizzas4.png"><meta property="og:updated_time" content="2017-03-11T12:54:27.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Cómo añadir un mapa a una app híbrida en Ionic"><meta name="twitter:description" content="Casi a diario tengo que trabajar con mapas dentro de aplicaciones de Angular, así que he decidido hacer un breve tutorial sobre ello.Para el ejemplo vamos a suponer que tenemos que hacer una app para"><meta name="twitter:image" content="https://github.com/images/2016-05/RoadTrip.jpg"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>Cómo añadir un mapa a una app híbrida en Ionic</title></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" style="display:none"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></span><br><div id="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Iniciando-el-proyecto"><span class="toc-number">1.</span> <span class="toc-text">Iniciando el proyecto</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Instalando-leaflet-y-anadiendo-el-mapa"><span class="toc-number">2.</span> <span class="toc-text">Instalando leaflet y añadiendo el mapa</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Personalizando-el-marcador"><span class="toc-number">3.</span> <span class="toc-text">Personalizando el marcador</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rutas"><span class="toc-number">4.</span> <span class="toc-text">Rutas</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Plugin-de-Rutas"><span class="toc-number">4.1.</span> <span class="toc-text">Plugin de Rutas</span></a></li></ol></li></ol></div></span></div><div class="content index width mx-auto px2 my4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Cómo añadir un mapa a una app híbrida en Ionic</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Emilio J. Grande | Web Developer</span></span><div class="postdate">&nbsp;<time datetime="2016-05-25T18:30:00.000Z" itemprop="datePublished">25-05-2016</time></div><div class="article-tag"><i class="fa fa-tag"></i> <a class="tag-link" href="/tags/ionic/">ionic</a></div></div></header><div class="content" itemprop="articleBody"><p>Casi a diario tengo que trabajar con mapas dentro de aplicaciones de Angular, así que he decidido hacer un breve tutorial sobre ello.<br><br><br>Para el ejemplo vamos a suponer que tenemos que hacer una app para una pizzería y mostrar en un mapa la localización de la misma. Se me ha ocurrido lo de la pizzería porque el otro día revisioné aquel capítulo de <a href="http://how-i-met-your-mother.wikia.com/wiki/Gazzola&#39;s" target="_blank" rel="external"><em>How I Met Your Mother</em> en el que Ted y Marshall van a la pizzería Gazzola’s</a>, en Chicago, a tope de latas de <em>Tantrum</em>. Rofl.</p><p><img src="/images/2016-05/RoadTrip.jpg" alt=""></p><h2 id="Iniciando-el-proyecto"><a href="#Iniciando-el-proyecto" class="headerlink" title="Iniciando el proyecto"></a>Iniciando el proyecto</h2><p><a href="/2015/06/tutorial-ionic-parte-uno/">Como todo proyecto de Ionic</a>, lo primero que tenemos que hacer es inicializarlo:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">ionic start mi-supertienda blank</div><div class="line">ionic serve</div></pre></td></tr></table></figure><p>Para el index.html vamos a poner:</p><ul><li>Un header.</li><li>Una pequeña tarjeta con una foto de una pizza (utilizando el estupendo servicio de <a href="http://lorempizza.com/" target="_blank" rel="external">LoremPizza.com</a>).</li><li>Otra tarjeta para el mapa.</li></ul><p>La cosa va siendo así:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ng-app</span>=<span class="string">"starter"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">ion-pane</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ion-header-bar</span> <span class="attr">class</span>=<span class="string">"bar-assertive"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"title"</span>&gt;</span>Super Pizzas!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">ion-header-bar</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ion-content</span> <span class="attr">padding</span>=<span class="string">"20"</span> <span class="attr">ng-controller</span>=<span class="string">"MainController as ctrl"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">h2</span>&gt;</span>¡Bienvenido a Super Pizzas!<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"item item-image"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"http://lorempizza.com/480/240"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"item item-icon-left"</span> <span class="attr">href</span>=<span class="string">"#"</span> <span class="attr">ng-click</span>=<span class="string">"ctrl.directions()"</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">"icon ion-map"</span>&gt;</span><span class="tag">&lt;/<span class="name">i</span>&gt;</span></div><div class="line">          ¡Pulsa para saber cómo llegar!</div><div class="line">        <span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">      <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card"</span>&gt;</span></div><div class="line">        mapa...</div><div class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">ion-content</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">ion-pane</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div></pre></td></tr></table></figure><p><img src="/images/2016-05/pizzas1.png" alt="Primer vistazo"></p><p>De momento no va mal. Solo con la foto de la pizza ganamos bastantes enteros :)</p><p>Ahora se trata de añadir el mapa.</p><h2 id="Instalando-leaflet-y-anadiendo-el-mapa"><a href="#Instalando-leaflet-y-anadiendo-el-mapa" class="headerlink" title="Instalando leaflet y añadiendo el mapa"></a>Instalando leaflet y añadiendo el mapa</h2><p>Para el mapa usaremos la biblioteca <a href="http://leafletjs.com/" target="_blank" rel="external">Leaflet</a>, que es de las que tiene más comunidad y mejor rendimiento da (a mí me gusta más que Google Maps).</p><p>Simplemente, bajamos <a href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.zip" target="_blank" rel="external">el .zip</a> y lo ponemos en la carpeta www/lib de la app. Luego es sólo añadir el .css y el .js en el index.html de la aplicación.</p><p>Con ello hecho, vamos a <strong>crear una directiva para el mapa</strong>. En este caso quiero que la directiva:</p><ul><li>Sea un atributo de un div.</li><li>Pinte el mapa.</li></ul><p>La cosa va así:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">.directive(<span class="string">'myMap'</span>, [ <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">return</span> &#123;</div><div class="line">    <span class="attr">restrict</span>: <span class="string">'A'</span>,</div><div class="line">    <span class="attr">link</span>: <span class="function"><span class="keyword">function</span> (<span class="params">scope</span>) </span>&#123;</div><div class="line">      <span class="keyword">var</span> map = L.map(<span class="string">'myMap'</span>).setView([<span class="number">40.4</span>, <span class="number">-3.7</span>], <span class="number">12</span>)</div><div class="line">      L.tileLayer(<span class="string">'http://&#123;s&#125;.basemaps.cartocdn.com/light_all/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png'</span>, &#123;</div><div class="line">        <span class="attr">attribution</span>: <span class="string">'&amp;copy; &lt;a href="http://www.openstreetmap.org/copyright"&gt;OpenStreetMap&lt;/a&gt; &amp;copy; &lt;a href="http://cartodb.com/attributions"&gt;CartoDB&lt;/a&gt;'</span></div><div class="line">      &#125;).addTo(map)</div><div class="line"></div><div class="line">      L.marker([<span class="number">40.4</span>, <span class="number">-3.7</span>])</div><div class="line">       .addTo(map)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;])</div></pre></td></tr></table></figure><p>El mapa deberá tener una altura. La definimos en CSS:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#myMap</span> &#123;</div><div class="line">  <span class="attribute">height</span>: <span class="number">40vh</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>La añadimos al HTML, de esta forma:<br></p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"card"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myMap"</span> <span class="attr">my-map</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure><p></p><p>Quedando así:</p><p><img src="/images/2016-05/pizzas2.png" alt="Mapa añadido"></p><p>Lo que hemos hecho es:</p><ul><li>Crear un mapa con <em>L.map</em>, indicándole un id, y poner el centro en unas coordenadas y un nivel de zoom con <em>setView</em>.</li><li>Después añadimos con <em>addTo</em> un mapa base creado con <em>L.tileLayer</em>. Para el mapa base he escogido el de <a href="https://cartodb.com/" target="_blank" rel="external">CartoDB</a>, que mola mucho, pero puedes elegir <a href="https://leaflet-extras.github.io/leaflet-providers/preview/" target="_blank" rel="external">entre un montón</a>.</li><li>Por último, añadimos un marcador en la posición del comercio (me la he inventado), con <em>L.marker</em>.</li></ul><h2 id="Personalizando-el-marcador"><a href="#Personalizando-el-marcador" class="headerlink" title="Personalizando el marcador"></a>Personalizando el marcador</h2><p>El marcador no está mal, pero lo chulo sería sacar algún dibujillo.</p><p>Para ello podríamos:</p><ul><li>Crear un icono a partir de una imagen, con <em>L.icon</em>.</li><li>Currar un poco más y crear un div, personalizándolo un poco, con <em>L.divIcon</em>.</li></ul><p>Vamos a utilizar esta segunda opción, <strong>metiendo dentro del div un SVG y personalizándolo con CSS</strong> (cualquier <em>no-informático</em> que oiga a alguien así debe parecerle un marciano T_T).</p><p>Bien, pues, con L.divIcon podemos hacer:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> myIcon = L.divIcon(&#123;</div><div class="line">              <span class="attr">className</span>: <span class="string">'pizzaIcon'</span>,</div><div class="line">              <span class="attr">html</span>: <span class="string">'&lt;svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" viewBox="0 0 512 512"&gt;'</span> +</div><div class="line">              <span class="string">'&lt;g&gt;'</span> +</div><div class="line">              <span class="string">'&lt;/g&gt;'</span> +</div><div class="line">              <span class="string">'&lt;path d="M249.262 255.693l229.612-39.792c1.853 12.851 3.072 26.327 3.072 39.792 0 132.239-104.1 239.401-232.684 239.401-129.188 0-233.267-107.161-233.267-239.401 0-131.625 104.079-238.776 233.267-238.776 26.327 0 52.665 4.895 77.763 13.476l-77.762 225.3zM219.259 281.385l69.796-222.843c-116.327-35.492-238.776 88.187-238.776 197.15 0 112.661 88.791 204.503 198.983 204.503 109.599 0 198.369-91.843 198.369-204.503 0-1.813 0-4.291 0-6.113l-228.373 31.805z" fill="#000000" /&gt;'</span> +</div><div class="line">              <span class="string">'&lt;path d="M496.005 165.694c-57.579 9.175-115.108 17.746-172.647 26.962l28.15-71.055c1.229 0.635 2.457 0.635 3.666 0.635 12.872 0 23.286-12.237 23.286-26.931 0-7.966-3.082-15.944-8.601-20.828l17.767-43.459c61.87 22.006 101.642 64.276 108.38 134.677v0zM442.747 117.954c-9.8 0-17.756 7.936-17.756 17.726s7.957 17.767 17.756 17.767c9.769 0 17.736-7.977 17.736-17.767s-7.966-17.725-17.736-17.725z" fill="#000000" /&gt;'</span> +</div><div class="line">              <span class="string">'&lt;path d="M196.004 301.609l210.617-18.985c0 1.843 0 3.676 0 5.54-0.604 15.278-3.072 28.743-6.134 40.981-6.123-8.56-15.923-14.060-27.546-14.060-18.37 0-33.045 14.060-33.045 31.222 0 17.142 14.674 31.222 33.044 31.222 1.219 0 2.447 0 3.656 0-39.782 50.821-111.431 64.901-175.094 45.302 2.447-1.802 3.686-4.885 3.686-7.936 0-7.363-6.748-13.476-14.121-13.476-7.332 0-13.445 5.519-14.060 12.237-56.34-25.723-99.82-80.2-96.133-157.962 3.666-92.436 79.616-208.793 178.155-178.78l-63.027 224.696zM260.894 322.447c-12.216 0-22.026 9.165-22.026 20.777 0 11.643 9.81 20.839 22.026 20.839 11.653 0 21.442-9.195 21.442-20.839-0.010-11.612-9.8-20.777-21.442-20.777v0zM128.030 285.686c-15.933 0-28.16 13.476-28.16 31.222 0 17.183 12.227 30.618 28.16 30.618 15.309 0 28.17-13.445 28.17-30.618 0-17.736-12.862-31.222-28.17-31.222v0zM167.823 172.431c-11.623 0-20.797 9.175-20.797 20.224 0 10.998 9.175 20.194 20.798 20.194 11.653 0 20.818-9.185 20.818-20.194 0-11.049-9.175-20.224-20.818-20.224z" fill="#000000" /&gt;'</span> +</div><div class="line">              <span class="string">'&lt;/svg&gt;'</span>,</div><div class="line">              <span class="attr">iconSize</span>: [<span class="number">32</span>, <span class="number">32</span>]</div><div class="line">            &#125;)</div></pre></td></tr></table></figure><p>Simplemente le pasamos los atributos <em>className</em>, <em>html</em> con el código del SVG dentro e <em>iconSize</em>.</p><p>Aunque es un poco sucio, meter el SVG <em>inline</em> nos va a permitir modificarlo con CSS, así:</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.pizzaIcon</span> &#123;</div><div class="line">  <span class="attribute">border-radius</span>: <span class="number">15px</span>;</div><div class="line">  <span class="attribute">background-color</span>: <span class="built_in">rgb</span>(230, 12, 12);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.pizzaIcon</span> <span class="selector-tag">svg</span> &#123;</div><div class="line">  <span class="attribute">width</span>: <span class="number">23px</span>;</div><div class="line">  <span class="attribute">height</span>: <span class="number">23px</span>;</div><div class="line">  <span class="attribute">left</span>: <span class="number">4px</span>;</div><div class="line">  <span class="attribute">top</span>: <span class="number">4px</span>;</div><div class="line">  <span class="attribute">position</span>: absolute;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.pizzaIcon</span> <span class="selector-tag">svg</span> <span class="selector-tag">path</span> &#123;</div><div class="line">  <span class="attribute">fill</span>: <span class="number">#fefefe</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>Por último añadimos el marcador pasándole un atributo icon:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">L.marker([<span class="number">40.4</span>, <span class="number">-3.7</span>], &#123;<span class="attr">icon</span>: myIcon&#125;)</div><div class="line"> .addTo(map)</div></pre></td></tr></table></figure><p>Y así vamos, de momento: ¡mucho mejor!</p><p><img src="/images/2016-05/pizzas3.png" alt="Icono personalizado"></p><h2 id="Rutas"><a href="#Rutas" class="headerlink" title="Rutas"></a>Rutas</h2><p>Por último, no estaría mal que le indicásemos a potenciales clientes cómo llegar al comercio (así Marshall y Ted podrán venir más cómodos :P ). Para ello podemos usar la geolocalización y calcular una ruta.</p><p>Aunque suena complicado, podemos hacer uso de un <em>plugin</em> de Leaflet que hará esto por nosotros. Para la geolocalización usaremos <a href="https://developer.mozilla.org/es/docs/WebAPI/Using_geolocation" target="_blank" rel="external">navigator.geolocation</a>, complementado con un <a href="https://cordova.apache.org/docs/en/latest/reference/cordova-plugin-geolocation/" target="_blank" rel="external">plugin de Cordova</a> que hará que funcione en el dispositivo móvil.</p><p>Vamos con ello.</p><h3 id="Plugin-de-Rutas"><a href="#Plugin-de-Rutas" class="headerlink" title="Plugin de Rutas"></a>Plugin de Rutas</h3><p>Lo primero que hay que hacer es instalar el plugin de rutas. Yo he escogido <a href="http://www.liedman.net/leaflet-routing-machine/" target="_blank" rel="external">Leaflet Routing Machine</a>.</p><p>De nuevo, simplemente es bajar <a href="https://github.com/perliedman/leaflet-routing-machine/releases">el .zip de Github</a> en www/lib y referenciar el css y el js en el index.html.</p><p>Ahora llega el momento de crear un controlador para manejar el evento click y desencadenar la lógica de geolocalización y rutas. Por simplicidad haré todo en el controlador, pero es una buena práctica no hacerlo, como explico en <a href="https://jsjutsu.com/angularjs-practico/" target="_blank" rel="external">el curso de Angular</a>.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">.controller(<span class="string">'MainController'</span>, [ <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> ctrl = <span class="keyword">this</span></div><div class="line">  ctrl.map = <span class="literal">null</span></div><div class="line"></div><div class="line">  ctrl.directions = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (<span class="string">'geolocation'</span> <span class="keyword">in</span> navigator) &#123;</div><div class="line">      navigator.geolocation.getCurrentPosition(<span class="function"><span class="keyword">function</span> (<span class="params">position</span>) </span>&#123;</div><div class="line">        L.marker([position.coords.latitude, position.coords.longitude])</div><div class="line">         .addTo(ctrl.map)</div><div class="line"></div><div class="line">        ctrl.map.setZoom(<span class="number">5</span>)</div><div class="line"></div><div class="line">        L.Routing.control(&#123;</div><div class="line">          <span class="attr">waypoints</span>: [</div><div class="line">            L.latLng(position.coords.latitude, position.coords.longitude),</div><div class="line">            L.latLng(<span class="number">40.4</span>, <span class="number">-3.7</span>)</div><div class="line">          ],</div><div class="line">          <span class="attr">createMarker</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="literal">null</span> &#125;</div><div class="line">        &#125;).addTo(ctrl.map).hide()</div><div class="line">      &#125;)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="built_in">console</span>.warn(<span class="string">'No geolocation available!'</span>)</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;])</div></pre></td></tr></table></figure><p>Bien, aquí hacemos muchas cosas, así que vamos por partes:</p><ul><li>Lo primero es crear una variable en el scope para el mapa: <strong>map</strong> (luego se asigna en la directiva).</li><li>Después creamos la función del scope <strong>directions</strong>, la cual:<ul><li>Comprueba si hay geolocalización disponible.</li><li>De ser así utiliza <strong>navigator.geolocation.getCurrentPosition</strong> para obtenerla.</li><li>Una vez obtenida, añade un marcador en la misma, que será la del usuario.</li><li>Reducimos un poco zoom (esto podríamos ajustarlo un poco teniendo en cuenta la posición del usuario).</li><li>Con <strong>L.Routing.control</strong> se pide una ruta que pase por los dos puntos, el inicial y el destino. Además se le indica que no queremos que ponga marcadores (ya los tenemos).</li><li>Por último añadimos el control al mapa y con <em>hide</em> escondemos el panel de instrucciones (por defecto saca un panel en el que va poniendo las instrucciones para llegar al destino).</li></ul></li></ul><p>Ahora, al pulsar en el botón designado, queda lo siguiente:</p><p><img src="/images/2016-05/pizzas4.png" alt="Ruta calculada"></p><p>¡Bien chulo!</p><hr><p>En este post has podido ver lo sencillo que es incluir un mapa en una aplicación. Lógicamente si quieres añadirle cosas se va complicando, pero Leaflet tiene muchos plugins, lo usa mucha gente y tiene una buena documentación.</p></div></article></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Iniciando-el-proyecto"><span class="toc-number">1.</span> <span class="toc-text">Iniciando el proyecto</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Instalando-leaflet-y-anadiendo-el-mapa"><span class="toc-number">2.</span> <span class="toc-text">Instalando leaflet y añadiendo el mapa</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Personalizando-el-marcador"><span class="toc-number">3.</span> <span class="toc-text">Personalizando el marcador</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rutas"><span class="toc-number">4.</span> <span class="toc-text">Rutas</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Plugin-de-Rutas"><span class="toc-number">4.1.</span> <span class="toc-text">Plugin de Rutas</span></a></li></ol></li></ol></div><div id="actions-footer"><ul><li id="toc"><a class="icon" href="#actions-footer"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li><li id="top" style="display:none"><a class="icon" href="#"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li><li id="menu"><a class="icon" href="#actions-footer"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li></ul></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2018 Emilio J. Grande</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></nav></div></footer><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/lib/meslo-LG/styles.css"><link rel="stylesheet" href="/css/style.css"><script src="/js/main.js"></script></body></html>