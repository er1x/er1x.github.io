<!DOCTYPE html><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="HandheldFriendly" content="True"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Es común a la hora de testear una web, hacer scraping o similar, tener que automatizar la navegación por alguna página web. SlimerJS es una herramienta que personalmente he utilizado para ello y me ha"><meta property="og:type" content="article"><meta property="og:title" content="Cómo automatizar navegación web con SlimerJS"><meta property="og:url" content="https://github.com/er1x/2015/09/web-scripting-slimerjs/index.html"><meta property="og:site_name" content="Emilio J. Grande | Web Developer"><meta property="og:description" content="Es común a la hora de testear una web, hacer scraping o similar, tener que automatizar la navegación por alguna página web. SlimerJS es una herramienta que personalmente he utilizado para ello y me ha"><meta property="og:image" content="https://github.com/er1x/images/2015-09/slimer-1.png"><meta property="og:image" content="https://github.com/er1x/images/2015-09/captura1.png"><meta property="og:image" content="https://github.com/er1x/images/2015-09/screenshot.png"><meta property="og:updated_time" content="2017-03-11T12:54:27.000Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Cómo automatizar navegación web con SlimerJS"><meta name="twitter:description" content="Es común a la hora de testear una web, hacer scraping o similar, tener que automatizar la navegación por alguna página web. SlimerJS es una herramienta que personalmente he utilizado para ello y me ha"><meta name="twitter:image" content="https://github.com/er1x/images/2015-09/slimer-1.png"><link rel="shortcut icon" href="/images/favicon.ico"><link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><title>Cómo automatizar navegación web con SlimerJS</title><style type="text/css">.content h1,.fa,body{-moz-osx-font-smoothing:grayscale}.fa{display:inline-block;font:normal normal normal 14px/1 FontAwesome;font-size:inherit;text-rendering:auto;-webkit-font-smoothing:antialiased}.content h1,.content h2,.content strong{font-weight:700}.highlight,body,pre{font-family:Menlo,"Meslo LG",monospace}.fa-lg{font-size:1.33333333em;line-height:.75em;vertical-align:-15%}.fa-tag:before{content:"\f02b"}.fa-list:before{content:"\f03a"}.fa-chevron-up:before{content:"\f077"}.fa-bars:before{content:"\f0c9"}#header-post #toc .toc-level-2:before,.article-tag .tag-link:before,article .content h2:before{content:"#"}*,:after,:before{box-sizing:border-box}.content h1,body{-webkit-font-smoothing:antialiased}body{text-rendering:geometricPrecision}.my4{margin-top:4rem;margin-bottom:4rem}.mx-auto{margin-left:auto;margin-right:auto}.px2{padding-left:1rem;padding-right:1rem}.content h1{letter-spacing:.01em;font-size:1.5em;font-style:normal;color:#2bbc8a;margin-top:3rem;margin-bottom:1rem;display:block}.content h2{position:relative;font-size:1rem;text-transform:none;letter-spacing:normal;margin-top:2rem;margin-bottom:.5rem;color:#eee;display:block}#header-post #nav ul li{border-right:1px dotted #2bbc8a}.content table{width:100%;font-size:12px;border-collapse:collapse;text-align:left}.content td{border-bottom:none;padding:9px 8px 0}html{height:100%;border-top:2px solid #c9cacc}body{line-height:1.725;color:#c9cacc;background-color:#1d1f21;font-size:14px;font-weight:400;min-height:100%;display:flex;flex-direction:column}.content{flex:1}.content p{-moz-hyphens:auto;-ms-hyphens:auto;-webkit-hyphens:auto;hyphens:auto}.content pre{-moz-hyphens:manual;-ms-hyphens:manual;-webkit-hyphens:manual;hyphens:manual}.content a{text-decoration:none;color:#c9cacc;background-repeat:repeat-x;background-position:bottom;background-size:100% 6px;background-image:linear-gradient(transparent,transparent 5px,#c9cacc 5px,#c9cacc)}#header-post a,.content h2 a{color:inherit;background:0 0;text-decoration:none}#header-post #nav ul li:last-child a,#header-post ul li:last-child{margin-right:0}.width{width:100%;max-width:39rem}@media (max-width:480px){.my4{margin-top:2rem;margin-bottom:2rem}}#header-post #nav ul{line-height:15px}#header-post #nav{font-style:normal;font-weight:200;letter-spacing:.01em;font-size:.8rem;color:#2bbc8a}#header-post{position:fixed;top:2rem;right:2rem;display:inline-block;float:right}#header-post ol{list-style-type:none}#header-post ul{list-style-type:none;margin:0;padding:0;display:inline-block}#header-post ul li{margin-right:15px;display:inline-block;vertical-align:middle}#header-post #menu-icon,#header-post #menu-icon-tablet{float:right;margin-left:15px}#header-post #top-icon-tablet{margin-left:15px;bottom:2rem;right:2rem;position:fixed}#header-post #menu{visibility:hidden}#header-post #nav ul a{margin-right:15px;color:color-accent}#header-post #nav ul li:last-child{border-right:0;margin-right:0}#header-post #toc{clear:both;text-align:right;padding-top:1rem}#header-post #toc .toc-number{display:none}#header-post #toc .toc-level-2{font-size:.8rem;color:#c9cacc}#header-post #toc .toc-level-2:before{color:#2bbc8a}@media screen and (max-width:500px){#header-post{display:none}}@media screen and (max-width:900px){#header-post #menu-icon{display:none}}@media screen and (max-width:1199px){#header-post #toc{display:none}}@media screen and (min-width:900px){#header-post #menu-icon-tablet,#header-post #top-icon-tablet{display:none!important}}#footer-post{bottom:0;left:0;right:0;position:fixed;width:100%;z-index:5000000;background:#212326;border-top:1px solid #666673}#footer-post a,#footer-post a.icon{background:0 0}#footer-post a{color:inherit;text-decoration:none}#footer-post #nav-footer{margin-left:1rem;margin-right:1rem;text-align:center}#footer-post #nav-footer a{color:#2bbc8a;font-size:1rem}#footer-post #actions-footer ul,#footer-post #nav-footer ul{list-style-type:none;margin:0;padding:0;display:table;width:100%}#footer-post #nav-footer ul li{display:inline-table;width:20%;padding:10px;vertical-align:middle}#footer-post #actions-footer{text-align:center;margin-top:1rem;margin-bottom:1rem;width:100%}#footer-post #actions-footer a{color:#2bbc8a}#footer-post #actions-footer ul li{display:table-cell;vertical-align:middle}#footer-post #toc-footer .toc-number{display:none}#footer-post #toc-footer{clear:both;text-align:left;padding-top:1rem}#footer-post #toc-footer ol{list-style-type:none;padding-left:20px}#footer-post #toc-footer ol li{line-height:30px}#footer-post #toc-footer .toc-level-2{font-size:.8rem;color:#c9cacc}#footer-post #toc-footer .toc-level-2:before{content:"#";color:#2bbc8a}@media screen and (min-width:500px){#footer-post-container{display:none}}article header .posttitle{margin-top:0;margin-bottom:0;text-transform:none;font-size:1.5em;line-height:1.25}article header .meta{margin-top:0;margin-bottom:1rem}article header .meta *{color:#ccc;font-size:.85rem}article header .author{text-transform:uppercase;letter-spacing:.01em;font-weight:700}article header .postdate{display:inline}article .content h2:before{color:#2bbc8a;position:absolute;left:-1rem;top:-4px;font-size:1.2rem;font-weight:700}article .content img{max-width:100%;height:auto;display:block;margin:auto}.posttitle{text-transform:none;font-size:1.5em;line-height:1.25}@media (min-width:480px){p{text-align:justify}.article-tag{display:inline}.article-tag:before{content:"|"}}.highlight,pre{overflow-x:auto}pre{font-size:13px;padding:10px 15px 0;line-height:22px;-webkit-border-radius:4px;border-radius:4px;border:1px dotted #666}.highlight{color:#d1d9e1;background:#212326;-webkit-border-radius:4px;border-radius:4px;padding:10px 15px;margin:1rem 0}.highlight pre{padding:0;border:none;background:0 0}.highlight table{width:auto}.highlight td.gutter{text-align:right;padding-right:20px;display:none}</style></head><body><div id="header-post"><a id="menu-icon" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="menu-icon-tablet" href="#"><i class="fa fa-bars fa-lg"></i></a> <a id="top-icon-tablet" href="#" style="display:none"><i class="fa fa-chevron-up fa-lg"></i></a> <span id="menu"><span id="nav"><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></span><br><div id="toc"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Instalacion-y-Apertura-de-una-Web"><span class="toc-number">1.</span> <span class="toc-text">Instalación y Apertura de una Web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Navegar-por-la-pagina-y-sacar-una-captura"><span class="toc-number">2.</span> <span class="toc-text">Navegar por la página y sacar una captura</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Otras-cuestiones"><span class="toc-number">3.</span> <span class="toc-text">Otras cuestiones</span></a></li></ol></div></span></div><div class="content index width mx-auto px2 my4"><article class="post" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 class="posttitle" itemprop="name headline">Cómo automatizar navegación web con SlimerJS</h1><div class="meta"><span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Emilio J. Grande | Web Developer</span></span><div class="postdate"><time datetime="2015-09-30T15:25:00.000Z" itemprop="datePublished">30-09-2015</time></div><div class="article-tag"><i class="fa fa-tag"></i> <a class="tag-link" href="/tags/slimerjs/">slimerjs</a></div></div></header><div class="content" itemprop="articleBody"><p><img src="/images/2015-09/slimer-1.png" alt="SlimerJS"></p><p>Es común a la hora de testear una web, hacer scraping o similar, tener que <strong>automatizar la navegación por alguna página web</strong>. <a href="http://slimerjs.org/" target="_blank" rel="external">SlimerJS</a> es una herramienta que personalmente he utilizado para ello y me ha dado muy buenos resultados. Su <strong>instalación y uso son muy sencillos</strong>.</p><p>Vamos a ver un ejemplo:</p><p>Supongamos que tenemos que crear un script que ejecutaremos diariamente, y que tiene que hacer una captura de pantalla de la noticia de portada de un diario deportivo.</p><p>Con SlimerJS podemos automatizar esto.</p><h2 id="Instalacion-y-Apertura-de-una-Web"><a href="#Instalacion-y-Apertura-de-una-Web" class="headerlink" title="Instalación y Apertura de una Web"></a>Instalación y Apertura de una Web</h2><p>La instalación de SlimerJS es sencilla. Puedes bien <a href="http://slimerjs.org/download.html" target="_blank" rel="external">descargártelo</a> o bien instalarlo a través de NPM.</p><p>Yo prefiero esta segunda opción:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install slimerjs -g</div></pre></td></tr></table></figure><p>Por otra parte, en el sistema que quieras ejecutar los scripts tendrás que tener instalado Firefox (Iceweasel también vale).</p><p>Una vez instalado, veamos un script sencillito:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> page = <span class="built_in">require</span>(<span class="string">'webpage'</span>).create();</div><div class="line">page.viewportSize = &#123; <span class="attr">width</span>: <span class="number">1024</span>, <span class="attr">height</span>: <span class="number">768</span> &#125;;</div><div class="line"></div><div class="line">page</div><div class="line">  .open(<span class="string">'http://www.marca.com/'</span>)</div><div class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    slimer.wait(<span class="number">1000</span>);</div><div class="line">    slimer.exit()</div><div class="line">  &#125;);</div></pre></td></tr></table></figure><p>Básicamente, ahí le estamos diciendo a SlimerJS que abra la web de Marca y espere durante un segundo.</p><p>Ejecutamos:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">slimerjs navigate.js</div></pre></td></tr></table></figure><p>Y este es el resultado:</p><p><img src="/images/2015-09/captura1.png" alt="captura1"></p><h2 id="Navegar-por-la-pagina-y-sacar-una-captura"><a href="#Navegar-por-la-pagina-y-sacar-una-captura" class="headerlink" title="Navegar por la página y sacar una captura"></a>Navegar por la página y sacar una captura</h2><p>Ook, ahora vamos a ver cómo pulsar en el titular de la web y sacar una captura de pantalla:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">var</span> page = <span class="built_in">require</span>(<span class="string">'webpage'</span>).create();</div><div class="line">page.viewportSize = &#123; <span class="attr">width</span>: <span class="number">1024</span>, <span class="attr">height</span>: <span class="number">768</span> &#125;;</div><div class="line"></div><div class="line">page</div><div class="line">  .open(<span class="string">'http://www.marca.com/'</span>)</div><div class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    slimer.wait(<span class="number">1000</span>);</div><div class="line">  &#125;)</div><div class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    page.evaluate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">      <span class="built_in">document</span>.querySelector(<span class="string">'.principal a'</span>).click();</div><div class="line">    &#125;);</div><div class="line">  &#125;)</div><div class="line">  .then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    slimer.wait(<span class="number">1000</span>);</div><div class="line">    page.render(<span class="string">'screenshot.png'</span>)</div><div class="line">    slimer.exit();</div><div class="line">  &#125;);</div></pre></td></tr></table></figure><p>Aquí, lo que hemos hecho es <strong>inyectar JavaScript en la web</strong> para hacer click en el enlace. SlimerJS nos permite evaluar JavaScript en el contexto del navegador, mediante <strong>page.evaluate</strong>.</p><p>Posteriormente generamos la captura con la función <strong>page.render</strong>. Los wait son para dar margen a que la página cargue correctamente, se quite la publicidad etc.</p><p>El aspecto de la captura de pantalla es tal que así (lo he recortado un poco porque captura la web entera):</p><p><img src="/images/2015-09/screenshot.png" alt="captura2"></p><hr><h2 id="Otras-cuestiones"><a href="#Otras-cuestiones" class="headerlink" title="Otras cuestiones"></a>Otras cuestiones</h2><p><strong>Q: ¿Por qué no hacer un simple wget o descargar la página?</strong></p><p>A: Wget, y otros métodos de descarga estáticos no interpretan JavaScript, por tanto si quieres automatizar algo en una web en la que su contenido sea dinámico es probable que tengas que tirar de un método de este tipo. <a href="http://phantomjs.org/" target="_blank" rel="external">PhantomJS</a> o <a href="http://www.seleniumhq.org/" target="_blank" rel="external">Selenium</a>.</p><p><strong>Q. ¿Para esto no se suele usar PhantomJS?</strong></p><p>A: Sí. En realidad para las necesidades que he tenido fue lo primero que probé. Sin embargo su sintaxis me parece más engorrosa y además me he encontrado con webs que no renderiza correctamente, y SlimerJS, al usar Firefox, sí.</p><p><strong>Q: Vale, pero para esto tengo que tener unas X instaladas y un navegador real</strong></p><p>A: Puedes utilizar <strong>xvfb-run</strong>. Yo lo he utilizado en Debian, con Iceweasel en un servidor sin entorno gráfico instalado y cero problemas.</p><p>Simplemente instala xvfb (apt, yum…) y ejecútalo así:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xvfb-run slimerjs tu-script.js</div></pre></td></tr></table></figure><hr><p>Y, como siempre, cualquier comentario es bienvenido :)</p></div></article></div><div id="footer-post-container"><div id="footer-post"><div id="nav-footer" style="display:none"><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></div><div id="toc-footer" style="display:none"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Instalacion-y-Apertura-de-una-Web"><span class="toc-number">1.</span> <span class="toc-text">Instalación y Apertura de una Web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Navegar-por-la-pagina-y-sacar-una-captura"><span class="toc-number">2.</span> <span class="toc-text">Navegar por la página y sacar una captura</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Otras-cuestiones"><span class="toc-number">3.</span> <span class="toc-text">Otras cuestiones</span></a></li></ol></div><div id="actions-footer"><ul><li id="toc"><a class="icon" href="#actions-footer"><i class="fa fa-list fa-lg" aria-hidden="true"></i> TOC</a></li><li id="top" style="display:none"><a class="icon" href="#"><i class="fa fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a></li><li id="menu"><a class="icon" href="#actions-footer"><i class="fa fa-bars fa-lg" aria-hidden="true"></i> Menu</a></li></ul></div></div></div><footer id="footer"><div class="footer-left">Copyright &copy; 2017 Emilio J. Grande</div><div class="footer-right"><nav><ul><li><a href="/">Home</a></li><li><a href="/archives">Writing</a></li><li><a href="/projects">Projects</a></li><li><a href="/about">About</a></li><li><a href="/contact">Contact</a></li></ul></nav></div></footer><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><link rel="stylesheet" href="/lib/meslo-LG/styles.css"><link rel="stylesheet" href="/css/style.css"><script src="/js/main.js"></script></body></html>